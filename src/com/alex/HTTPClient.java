package com.alex;

/**
 * Created by caozhennan on 2019/12/3 5:43 下午.
 */

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.math.BigInteger;
import java.net.HttpURLConnection;
import java.net.URL;

import com.alex.common.Utils;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;

public class HTTPClient {
    public static void main(String[] args) throws Exception {
        for (String[] c : cases) {
            get(c);
//            break;
        }
    }

    private static void get(String[] c) throws Exception {
        BigInteger a = new BigInteger("100");
        BigInteger b = a.mod(new BigInteger("2"));

        String u = String.format(url, c[2], c[1], c[4], c[3]);

        HttpURLConnection conn = (HttpURLConnection) new URL(u).openConnection();
        conn.setRequestMethod("GET");
        conn.setRequestProperty("User-Agent", "PostmanRuntime/7.19.0");

        int responseCode = conn.getResponseCode();
//        System.out.printf("Sent 'GET' %s request, ", c[0]);
//        System.out.println("response Code : " + responseCode);

        BufferedReader in = new BufferedReader(
                new InputStreamReader(conn.getInputStream()));
        String line;
        StringBuilder response = new StringBuilder();
        while ((line = in.readLine()) != null) {
            response.append(line);
        }
        in.close();
//        System.out.println(response.toString());

        ResponseWrapper r = Utils.json2Object(response.toString().getBytes(), ResponseWrapper.class);
        if (r == null) {
            System.out.println("wrong format");
        } else if (r.response == null) {
            System.out.println("wrong format: response");
        } else if (r.response.route == null) {
            System.out.println("wrong format: route");
        } else if (r.response.route.length > 1) {
            System.out.printf("wrong format: %d routes", r.response.route.length);
        } else if (r.response.route[0].leg == null) {
            System.out.println("wrong format: leg");
        } else if (r.response.route[0].leg.length > 1) {
            System.out.printf("wrong format: %d legs", r.response.route[0].leg.length);
        } else {
//            System.out.println("eta = " + r.response.route[0].leg[0].travelTime);
//            System.out.println("eda = " + r.response.route[0].leg[0].length);
            StringBuilder sb = new StringBuilder();
//            for (Maneuver m : r.response.route[0].leg[0].maneuver) {
//                sb.append(String.format("%s,%s", m.position.longitude, m.position.latitude)).append(";");
//            }
//            System.out.println("shapes: " + r.response.route[0].shape.length);
            for (String s : r.response.route[0].shape) {
                String[] fs = s.split(",");
                sb.append(String.format("%s,%s", fs[1], fs[0])).append(";");
            }
            System.out.printf("%s\t%s\t%s\t%s\t%s|eta0=%d|eda0=%d|geo0=%s\n", c[0], c[1], c[2], c[3], c[4],
                    r.response.route[0].leg[0].travelTime,
                    r.response.route[0].leg[0].length,
                    sb.toString());
        }
    }

    @JsonIgnoreProperties(ignoreUnknown = true)
    private static class Position {
        public Position() {
        }

        public void setLatitude(String latitude) {
            this.latitude = latitude;
        }

        public void setLongitude(String longitude) {
            this.longitude = longitude;
        }

        public String getLatitude() {
            return latitude;
        }

        public String getLongitude() {
            return longitude;
        }

        String latitude;
        String longitude;
    }

    @JsonIgnoreProperties(ignoreUnknown = true)
    private static class Maneuver {
        public void setPosition(Position position) {
            this.position = position;
        }

        public Position getPosition() {
            return position;
        }

        public Maneuver() {
        }

        Position position;
    }

    @JsonIgnoreProperties(ignoreUnknown = true)
    private static class Leg {
        public long getLength() {
            return length;
        }

        public int getTravelTime() {
            return travelTime;
        }

        public Maneuver[] getManeuver() {
            return maneuver;
        }

        public void setLength(long length) {
            this.length = length;
        }

        public void setTravelTime(int travelTime) {
            this.travelTime = travelTime;
        }

        public void setManeuver(Maneuver[] maneuver) {
            this.maneuver = maneuver;
        }

        public Leg() {
        }

        long length;
        int travelTime;
        Maneuver[] maneuver;
    }

    @JsonIgnoreProperties(ignoreUnknown = true)
    private static class Route {
        public void setLeg(Leg[] leg) {
            this.leg = leg;
        }

        public Leg[] getLeg() {
            return leg;
        }

        public Route() {
        }

        String[] shape;
        Leg[] leg;

        public String[] getShape() {
            return shape;
        }

        public void setShape(String[] shape) {
            this.shape = shape;
        }
    }

    @JsonIgnoreProperties(ignoreUnknown = true)
    private static class Response {
        public void setRoute(Route[] route) {
            this.route = route;
        }

        public Route[] getRoute() {
            return route;
        }

        public Response() {
        }

        Route[] route;
    }

    @JsonIgnoreProperties(ignoreUnknown = true)
    private static class ResponseWrapper {
        public void setResponse(Response response) {
            this.response = response;
        }

        public Response getResponse() {
            return response;
        }

        public ResponseWrapper() {
        }

        Response response;
    }

    private static final String url = "https://route.api.here.com/routing/7.2/calculateroute.json?app_id=0fulQgcHo7jbDRfe3Q6x&app_code=h0NSaHGT6hCyEkevY0E4Lw&waypoint0=geo!%s,%s&waypoint1=geo!%s,%s&mode=fastest;car;traffic:disabled&routeattributes=sh";
    private static final String[][] cases = {
            /* first batch
            {"1", "29.985831", "60.049075", "30.325377", "59.910062"},
            {"2", "30.205557", "60.01958", "30.300744", "59.911471"},
            {"3", "30.233023", "59.986624", "30.240728", "59.914461"},
            {"4", "30.300314", "60.011344", "30.237895", "59.908308"},
            {"5", "30.418417", "60.009971", "30.269416", "59.902444"},
            {"6", "30.460989", "59.990745", "30.281711", "59.907081"},
            {"7", "30.395072", "59.966697", "30.29892", "59.907684"},
            {"8", "30.333255", "59.928786", "30.361066", "59.95501"},
            {"9", "30.285876", "59.9287", "30.352483", "59.989371"},
            {"10", "30.231288", "59.943061", "30.298238", "59.990917"},
            {"11", "30.316794", "59.91373", "30.21921", "59.991582"},
            {"12", "30.286582", "59.893759", "30.294972", "59.919839"},
            {"13", "30.252249", "59.886181", "29.985831", "60.049075"},
            {"14", "30.294544", "59.888722", "30.205557", "60.01958"},
            {"15", "30.317975", "59.892425", "30.233023", "59.986624"},
            {"16", "30.324499", "59.899614", "30.300314", "60.011344"},
            {"17", "30.274373", "59.900647", "30.418417", "60.009971"},
            {"18", "30.265361", "59.900862", "30.460989", "59.990745"},
            {"19", "30.249139", "59.888549", "30.395072", "59.966697"},
            {"20", "29.669974", "59.92199", "30.333255", "59.928786"},
            {"21", "29.831319", "59.888076", "30.285876", "59.9287"},
            {"22", "29.90891", "59.887214", "30.231288", "59.943061"},
            {"23", "30.4136", "59.867228", "30.316794", "59.91373"},
            {"24", "30.217558", "59.82532", "30.286582", "59.893759"},
            {"25", "29.996458", "59.852575", "30.252249", "59.886181"},
            {"26", "30.348188", "59.926506", "30.294544", "59.888722"},
            {"27", "30.329906", "59.919925", "30.317975", "59.892425"},
            {"28", "30.292999", "59.930334", "30.324499", "59.899614"},
            {"29", "30.319091", "59.927066", "30.274373", "59.900647"},
            {"30", "30.350334", "59.927496", "30.265361", "59.900862"},
            {"31", "30.360032", "59.93128", "30.249139", "59.888549"},
            {"32", "30.285488", "59.944716", "29.669974", "59.92199"},
            {"33", "30.27433", "59.943362", "29.831319", "59.888076"},
            {"34", "30.264888", "59.945748", "29.90891", "59.887214"},
            {"35", "30.259352", "59.947296", "30.4136", "59.867228"},
            {"36", "30.256005", "59.947704", "30.217558", "59.82532"},
            {"37", "30.24416", "59.949531", "29.996458", "59.852575"},
            {"38", "30.242401", "59.949079", "30.348188", "59.926506"},
            {"39", "30.237036", "59.945533", "30.329906", "59.919925"},
            {"40", "30.221244", "59.944738", "30.292999", "59.930334"},
            {"41", "30.215579", "59.945877", "30.319091", "59.927066"},
            {"42", "30.210129", "59.94319", "30.350334", "59.927496"},
            {"43", "30.225063", "59.941965", "30.360032", "59.93128"},
            {"44", "30.214678", "59.938762", "30.285488", "59.944716"},
            {"45", "30.257722", "59.927754", "30.27433", "59.943362"},
            {"46", "30.293256", "59.930334", "30.264888", "59.945748"},
            {"47", "30.362178", "59.929517", "30.259352", "59.947296"},
            {"48", "30.366319", "59.922861", "30.256005", "59.947704"},
            {"49", "30.331257", "59.920968", "30.24416", "59.949531"},
            {"50", "30.316108", "59.916161", "30.242401", "59.949079"},
            {"51", "30.29892", "59.907684", "29.831319", "59.888076"},
            {"52", "29.669974", "59.92199", "30.217558", "59.82532"},
            {"53", "29.831319", "59.888076", "29.996458", "59.852575"},
            {"54", "29.90891", "59.887214", "30.348188", "59.926506"},
            {"55", "30.4136", "59.867228", "30.329906", "59.919925"},
            {"56", "30.217558", "59.82532", "30.292999", "59.930334"},
            {"57", "30.210129", "59.94319", "30.319091", "59.927066"},
            {"58", "30.348188", "59.926506", "30.333255", "59.928786"},
            {"59", "30.329906", "59.919925", "30.285876", "59.9287"},
            {"60", "30.292999", "59.930334", "30.231288", "59.943061"},
            {"61", "30.319091", "59.927066", "29.985831", "60.049075"},
            {"62", "30.350334", "59.927496", "30.205557", "60.01958"},
            {"63", "30.360032", "59.93128", "30.233023", "59.986624"},
            {"64", "30.285488", "59.944716", "30.300314", "60.011344"},
            {"65", "30.27433", "59.943362", "30.418417", "60.009971"}
             */
            {"1", "37.547622", "55.812857", "37.452865", "55.85065"},
            {"2", "37.455611", "55.741801", "37.594314", "55.768849"},
            {"3", "37.586074", "55.719376", "37.69731", "55.852192"},
            {"4", "37.661605", "55.77889", "37.746749", "55.683004"},
            {"5", "37.660232", "55.85065", "37.381454", "55.643499"},
            {"6", "37.531142", "55.858358", "37.678084", "55.937664"},
            {"7", "37.454238", "55.831373", "37.923903", "55.648924"},
            {"8", "37.430892", "55.779662", "37.708297", "55.623344"},
            {"9", "37.510543", "55.665968", "37.417159", "55.750304"},
            {"10", "37.897811", "55.712414", "37.321029", "55.811314"},
            {"11", "37.870345", "55.822888", "37.540755", "55.564369"},
            {"12", "37.804427", "55.880703", "37.614913", "55.747985"},
            {"13", "37.643752", "55.936895", "37.844253", "55.569028"},
            {"14", "37.487197", "55.913812", "37.870345", "55.808999"},
            {"15", "37.333388", "55.808999", "37.591567", "55.925355"},
            {"16", "37.360854", "55.700034", "37.444625", "55.80514"},
            {"17", "37.466598", "55.634198", "37.778335", "55.70545"},
            {"18", "37.634139", "55.633423", "37.489944", "55.683779"},
            {"19", "37.789321", "55.66132", "37.594314", "55.754941"},
            {"20", "37.645125", "55.593867", "37.654738", "55.734843"},
            {"1", "43.829055", "56.269286", "43.698592", "56.308158"},
            {"2", "43.798842", "56.34014", "43.710952", "56.242587"},
            {"3", "43.956771", "56.308158", "43.813949", "56.236481"},
            {"4", "44.025435", "56.25098", "43.99797", "56.202885"},
            {"5", "43.863387", "56.155494", "44.057021", "56.258609"},
            {"6", "44.055648", "56.262422", "44.040542", "56.155494"},
            {"7", "44.181991", "56.372095", "43.905959", "56.302825"},
            {"8", "44.066634", "56.403264", "43.956771", "56.341662"},
            {"9", "43.919692", "56.414661", "43.926558", "56.302063"},
            {"10", "43.708205", "56.347751", "44.006209", "56.300539"},
            {"11", "43.767257", "56.239534", "43.999343", "56.422257"},
            {"12", "43.638167", "56.189896", "43.791976", "56.423017"},
            {"13", "43.804336", "56.12948", "44.08998", "56.388823"},
            {"14", "44.066634", "56.126419", "44.133925", "56.356121"},
            {"15", "44.160018", "56.199065", "44.121566", "56.322629"},
            {"16", "44.254775", "56.260134", "44.080367", "56.252506"},
            {"17", "44.254775", "56.334812", "44.177871", "56.244876"},
            {"18", "43.87712", "56.300539", "44.245162", "56.331005"},
            {"19", "44.040542", "56.286059", "44.153152", "56.186839"},
            {"20", "43.852401", "56.318822", "43.926558", "56.199829"},
            {"1", "39.750831", "43.608737", "39.732292", "43.644026"},
            {"2", "39.840095", "43.624644", "39.742591", "43.630608"},
            {"3", "39.754951", "43.58238", "39.714439", "43.62862"},
            {"4", "39.732292", "43.5973", "39.735725", "43.604759"},
            {"5", "39.724739", "43.6152", "39.746711", "43.589344"},
            {"6", "39.729545", "43.629614", "39.736412", "43.576909"},
            {"7", "39.798896", "43.571437", "39.68766", "43.640051"},
            {"8", "39.954078", "43.457903", "39.768684", "43.566959"},
            {"9", "39.955451", "43.476342", "39.787223", "43.549543"},
            {"10", "39.929359", "43.450925", "39.78585", "43.58437"},
            {"11", "39.77967", "43.564969", "39.689033", "43.645516"},
            {"12", "39.741218", "43.579396", "39.664314", "43.656447"},
            {"13", "39.717872", "43.601279", "39.732292", "43.573427"},
            {"14", "39.708259", "43.63359", "39.713066", "43.581386"},
            {"15", "39.6856", "43.644026", "39.827735", "43.537101"},
            {"16", "39.668434", "43.655453", "39.873741", "43.517186"},
            {"17", "39.666374", "43.68277", "39.943779", "43.449928"},
            {"18", "39.725425", "43.671348", "39.715812", "43.625141"},
            {"19", "39.772804", "43.63359", "39.716499", "43.612217"},
            {"20", "39.736412", "43.614702", "39.729545", "43.608737"},
            {"1", "37.569594", "54.261214", "37.577834", "54.18253"},
            {"2", "37.510543", "54.248378", "37.524276", "54.194583"},
            {"3", "37.546248", "54.227511", "37.528396", "54.220285"},
            {"4", "37.521529", "54.19137", "37.553115", "54.245168"},
            {"5", "37.638259", "54.188959", "37.654738", "54.19137"},
            {"6", "37.616286", "54.158414", "37.656112", "54.245168"},
            {"7", "37.531142", "54.160022", "37.576461", "54.274046"},
            {"8", "37.445998", "54.200207", "37.481704", "54.229919"},
            {"9", "37.650619", "54.229116", "37.49269", "54.168866"},
            {"10", "37.619033", "54.268432", "37.58882", "54.135892"},
            {"11", "37.693191", "54.200207", "37.656112", "54.16163"},
            {"12", "37.69731", "54.16967", "37.690444", "54.205027"},
            {"13", "37.559981", "54.295691", "37.543502", "54.213861"},
            {"14", "37.470717", "54.247575", "37.669845", "54.229919"},
            {"15", "37.441878", "54.225905", "37.639632", "54.28527"},
            {"16", "37.424026", "54.19619", "37.547622", "54.283667"},
            {"17", "37.473464", "54.171278", "37.481704", "54.258005"},
            {"18", "37.50093", "54.137501", "37.447371", "54.225102"},
            {"19", "37.672591", "54.135087", "37.540755", "54.133478"},
            {"20", "37.72203", "54.168062", "37.469344", "54.143937"},
            {"1", "36.044319", "52.942432", "36.045692", "52.973454"},
            {"2", "36.035392", "52.96477", "36.072471", "52.975108"},
            {"3", "36.084831", "52.964357", "36.086891", "52.966838"},
            {"4", "36.097877", "52.942018", "36.099937", "52.956498"},
            {"5", "36.060112", "52.928775", "36.094444", "52.943259"},
            {"6", "36.006553", "52.966424", "36.066291", "52.939121"},
            {"7", "35.977027", "52.933327", "36.046379", "52.95898"},
            {"8", "36.00518", "52.906417", "36.049812", "52.946983"},
            {"9", "36.163795", "52.901448", "36.058052", "52.940363"},
            {"10", "36.240013", "52.98627", "36.045692", "52.936224"},
            {"11", "36.140449", "53.050295", "36.032646", "52.95443"},
            {"12", "35.990074", "53.033781", "36.110237", "52.96477"},
            {"13", "36.060112", "52.9445", "36.10131", "52.950706"},
            {"14", "36.080024", "52.946155", "36.093757", "52.936224"},
            {"15", "36.063545", "52.936638", "36.073158", "52.932086"},
            {"16", "36.064231", "52.934155", "36.044319", "52.978416"},
            {"17", "36.091011", "52.943673", "36.029899", "52.965597"},
            {"18", "36.083457", "52.952775", "36.086204", "52.984617"},
            {"19", "36.083457", "52.960634", "36.106117", "52.975108"},
            {"20", "36.024406", "52.965184", "36.10749", "52.968906"}
    };
}
